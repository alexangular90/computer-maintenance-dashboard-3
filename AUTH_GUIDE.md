# üîê –°–∏—Å—Ç–µ–º–∞ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## –î–µ–º–æ-–∞–∫–∫–∞—É–Ω—Ç—ã

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç 4 —Ä–æ–ª–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –¥–æ—Å—Ç—É–ø–∞:

### üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- **–õ–æ–≥–∏–Ω:** `admin`
- **–ü–∞—Ä–æ–ª—å:** `admin123`
- **–ü—Ä–∞–≤–∞:** –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ä–∞–∑–¥–µ–ª–∞–º –∏ —Ñ—É–Ω–∫—Ü–∏—è–º

### üíº –ú–µ–Ω–µ–¥–∂–µ—Ä
- **–õ–æ–≥–∏–Ω:** `manager`
- **–ü–∞—Ä–æ–ª—å:** `manager123`
- **–ü—Ä–∞–≤–∞:** –ó–∞—è–≤–∫–∏, –∫–ª–∏–µ–Ω—Ç—ã, —Å–∫–ª–∞–¥, —Ç–µ—Ö–Ω–∏–∫–∏, –≥—Ä–∞—Ñ–∏–∫, —Ñ–∏–Ω–∞–Ω—Å—ã, –æ—Ç—á—ë—Ç—ã

### üîß –¢–µ—Ö–Ω–∏–∫
- **–õ–æ–≥–∏–Ω:** `tech`
- **–ü–∞—Ä–æ–ª—å:** `tech123`
- **–ü—Ä–∞–≤–∞:** –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —Ä–∞–±–æ—Ç–∞ —Å –∑–∞—è–≤–∫–∞–º–∏, –¥–∞—à–±–æ—Ä–¥

### üìã –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–†–µ—Å–µ–ø—à–Ω)
- **–õ–æ–≥–∏–Ω:** `reception`
- **–ü–∞—Ä–æ–ª—å:** `reception123`
- **–ü—Ä–∞–≤–∞:** –ü—Ä–∏—ë–º –∑–∞—è–≤–æ–∫, —Ä–∞–±–æ—Ç–∞ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –¥–∞—à–±–æ—Ä–¥

---

## –†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º

| –†–∞–∑–¥–µ–ª | –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä | –ú–µ–Ω–µ–¥–∂–µ—Ä | –¢–µ—Ö–Ω–∏–∫ | –†–µ—Å–µ–ø—à–Ω |
|--------|--------------|----------|--------|---------|
| –î–∞—à–±–æ—Ä–¥ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| –ó–∞—è–≤–∫–∏ | ‚úÖ | ‚úÖ | ‚úÖ (–ø—Ä–æ—Å–º–æ—Ç—Ä) | ‚úÖ |
| –ö–ª–∏–µ–Ω—Ç—ã | ‚úÖ | ‚úÖ | ‚ùå | ‚úÖ |
| –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –°–∫–ª–∞–¥ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –¢–µ—Ö–Ω–∏–∫–∏ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –ì—Ä–∞—Ñ–∏–∫ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –§–∏–Ω–∞–Ω—Å—ã | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –û—Ç—á—ë—Ç—ã | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∏ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### 1. –ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤

```tsx
import ProtectedRoute from '@/components/ProtectedRoute';

// –ó–∞—â–∏—Ç–∞ –≤—Å–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
<Route 
  path="/admin" 
  element={
    <ProtectedRoute requiredRole="admin">
      <AdminPanel />
    </ProtectedRoute>
  } 
/>

// –ó–∞—â–∏—Ç–∞ –ø–æ —Ä–∞–∑–¥–µ–ª—É
<Route 
  path="/finance" 
  element={
    <ProtectedRoute section="finance">
      <FinanceSection />
    </ProtectedRoute>
  } 
/>
```

### 2. –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```tsx
import Permission from '@/components/Permission';

// –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º
<Permission requiredRole="admin">
  <Button>–£–¥–∞–ª–∏—Ç—å –≤—Å—ë</Button>
</Permission>

// –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º –∏ –∞–¥–º–∏–Ω–∞–º
<Permission requiredRole={['admin', 'manager']}>
  <Button>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</Button>
</Permission>

// –° fallback
<Permission requiredRole="admin" fallback={<div>–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</div>}>
  <SensitiveData />
</Permission>
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö—É–∫–∞ useAuth

```tsx
import { useAuth } from '@/contexts/AuthContext';

function MyComponent() {
  const { user, hasPermission, canAccess, logout } = useAuth();

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏
  if (hasPermission('admin')) {
    // –ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–∞–∑–¥–µ–ª—É
  if (canAccess('finance')) {
    // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–Ω–∞–Ω—Å—ã
  }

  // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
  console.log(user.fullName, user.role);

  return (
    <div>
      <h1>–ü—Ä–∏–≤–µ—Ç, {user.fullName}!</h1>
      <Button onClick={logout}>–í—ã–π—Ç–∏</Button>
    </div>
  );
}
```

### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö—É–∫–∞ usePermissions

```tsx
import { usePermissions } from '@/hooks/usePermissions';

function RepairsSection() {
  const { can, isAdmin, isTechnician } = usePermissions();

  return (
    <div>
      {can.createRepair() && (
        <Button>–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</Button>
      )}
      
      {can.deleteRepair() && (
        <Button variant="destructive">–£–¥–∞–ª–∏—Ç—å</Button>
      )}

      {isAdmin && <AdminControls />}
      {isTechnician && <TechnicianView />}
    </div>
  );
}
```

### 5. –ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

```tsx
import { useAuth } from '@/contexts/AuthContext';
import { useNavigate } from 'react-router-dom';

function LoginButton() {
  const { login } = useAuth();
  const navigate = useNavigate();

  const handleLogin = async () => {
    try {
      await login('admin', 'admin123');
      navigate('/');
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
    }
  };

  return <Button onClick={handleLogin}>–í–æ–π—Ç–∏</Button>;
}
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –°–µ—Å—Å–∏—è
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 24 —á–∞—Å–∞
- **–•—Ä–∞–Ω–µ–Ω–∏–µ:** localStorage (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ)
- **–ê–≤—Ç–æ–≤—ã—Ö–æ–¥:** –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∏
- –í—Å–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–∞–≤ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç
- –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Üí `/login`

### –ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ–ª–µ–π
```
admin (4) > manager (3) > technician (2) > receptionist (1)
```

–†–æ–ª—å —Å –±√≥–ª—å—à–∏–º —á–∏—Å–ª–æ–º –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º –Ω–∏–∂–µ—Å—Ç–æ—è—â–∏—Ö —Ä–æ–ª–µ–π.

---

## API AuthService

```typescript
// –í—Ö–æ–¥
await authService.login(username, password);

// –í—ã—Ö–æ–¥
authService.logout();

// –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const user = authService.getCurrentUser();

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏
const isValid = authService.isSessionValid();

// –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–µ–º–æ-–∞–∫–∫–∞—É–Ω—Ç–æ–≤
const users = authService.getMockUsers();
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/
‚îú‚îÄ‚îÄ contexts/
‚îÇ   ‚îî‚îÄ‚îÄ AuthContext.tsx          # –ö–æ–Ω—Ç–µ–∫—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ authService.ts           # –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ProtectedRoute.tsx       # HOC –¥–ª—è –∑–∞—â–∏—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ Permission.tsx           # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —É—Å–ª–æ–≤–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
‚îÇ   ‚îî‚îÄ‚îÄ UserMenu.tsx             # –ú–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ usePermissions.ts        # –•—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∞–≤–∞–º–∏
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îî‚îÄ‚îÄ Login.tsx                # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ types/
    ‚îî‚îÄ‚îÄ index.ts                 # –¢–∏–ø—ã User, UserRole, AuthState
```

---

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ä–æ–ª–∏

1. –î–æ–±–∞–≤–∏—Ç—å –≤ `src/types/index.ts`:
```typescript
export type UserRole = 'admin' | 'manager' | 'technician' | 'receptionist' | 'newrole';
```

2. –û–±–Ω–æ–≤–∏—Ç—å `roleHierarchy` –≤ `AuthContext.tsx`:
```typescript
const roleHierarchy: Record<UserRole, number> = {
  admin: 5,
  newrole: 4,  // –ù–æ–≤–∞—è —Ä–æ–ª—å
  manager: 3,
  technician: 2,
  receptionist: 1
};
```

3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –≤ `sectionPermissions`:
```typescript
const sectionPermissions: Record<string, UserRole[]> = {
  newsection: ['admin', 'newrole'],
  // ...
};
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞

–û–±–Ω–æ–≤–∏—Ç—å `sectionPermissions` –≤ `AuthContext.tsx`:
```typescript
const sectionPermissions: Record<string, UserRole[]> = {
  // ...existing
  analytics: ['admin', 'manager'],  // –ù–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª
};
```

---

## Troubleshooting

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è
- –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Application ‚Üí Local Storage
- –£–¥–∞–ª–∏—Ç–µ –∫–ª—é—á `auth_user` –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

### –†–∞–∑–¥–µ–ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–∞–∑–¥–µ–ª –¥–æ–±–∞–≤–ª–µ–Ω –≤ `sectionPermissions`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ–±—ë—Ä–Ω—É—Ç –≤ `<ProtectedRoute>`

### –°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ
–ò–∑–º–µ–Ω–∏—Ç–µ `SESSION_DURATION` –≤ `authService.ts`:
```typescript
const SESSION_DURATION = 48 * 60 * 60 * 1000; // 48 —á–∞—Å–æ–≤
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

‚úÖ **DO:**
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `<ProtectedRoute>` –¥–ª—è –∑–∞—â–∏—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–∞–≤–∞ –ø–µ—Ä–µ–¥ –≤–∞–∂–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ (—É–¥–∞–ª–µ–Ω–∏–µ, –∏–∑–º–µ–Ω–µ–Ω–∏–µ)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `<Permission>` –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è UI
- –õ–æ–≥–∏—Ä—É–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∞—É–¥–∏—Ç–∞

‚ùå **DON'T:**
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
- –ù–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É (–¥–æ–±–∞–≤—å—Ç–µ —Å–µ—Ä–≤–µ—Ä–Ω—É—é)
- –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –∫ –∫–æ—Ç–æ—Ä—ã–º –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞
- –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏—Å—Ç–µ—á–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
